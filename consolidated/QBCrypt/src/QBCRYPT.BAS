' QBCRYPT.BAS 1.0
'   by Chris Stoddard
' Copyright (C) 1994 DOS Resource Guide
' Published in Issue #15, May 1994, page 65
' Additional information in Issue #17, September 1994, page 67

BEGIN:
  COLOR 15, 1
  CLS : ON ERROR GOTO ERRTRAP
  COLOR 15, 4
  PRINT SPACE$(34); "QBCRYPT.BAS"; SPACE$(35)
  COLOR 15, 1: PRINT
  PRINT "OPTIONS:"
  PRINT "1= ENCRYPT FILE"
  PRINT "2= DECIPHER FILE"
  PRINT "3= QUIT PROGRAM"
  PRINT : PRINT "ENTER YOUR CHOICE";
 
SCANKEY:
  K$ = INKEY$
  IF K$ = "" THEN GOTO SCANKEY
  IF K$ = "1" THEN GOTO ENCRYPT
  IF K$ = "2" THEN GOTO DECIPHER
  IF K$ = "3" THEN GOTO QUIT
  GOTO SCANKEY

ENCRYPT:
  LOCATE 10, 1: INPUT "FILE TO BE ENCRYPTED "; FILE$
  INPUT "SAVE ENCRYPTED FILE AS "; NAME$
  GOSUB PASSWORD
  LOCATE 24, 60: PRINT "ENCRYPTING FILE ";
  OPEN FILE$ FOR INPUT AS #1
  OPEN NAME$ FOR OUTPUT AS #2
    WHILE NOT EOF(1)
      GOSUB THINK1
      BYTE$ = INPUT$(1, #1)
      PASSKEY = INT(RND * 255) + 32
      IF PASSKEY > 223 THEN PASSKEY = 223
      x = (ASC(BYTE$) + PASSKEY)
      IF x > 255 THEN x = ((x - 255) + 32)
      CRYPT$ = CHR$(x)
      PRINT #2, CRYPT$;
      GOSUB THINK2
    WEND
  CLOSE
  GOTO BEGIN

DECIPHER:
  LOCATE 10, 1: INPUT "FILE TO BE DECRYPTED "; FILE$
  INPUT "NAME OF DECRYPTED FILE "; NAME$
  GOSUB PASSWORD
  LOCATE 24, 60: PRINT "DECRYPTING FILE";
  OPEN FILE$ FOR INPUT AS #1
  OPEN NAME$ FOR OUTPUT AS #2
    WHILE NOT EOF(1)
      GOSUB THINK1
      BYTE$ = INPUT$(1, #1)
      PASSKEY = INT(RND * 255) + 32
      IF PASSKEY > 223 THEN PASSKEY = 223
      x = (ASC(BYTE$) - PASSKEY)
      IF x < 1 THEN x = ((x + 255) - 32)
      CRYPT$ = CHR$(x)
      PRINT #2, CRYPT$;
      GOSUB THINK2
    WEND
  CLOSE
  GOTO BEGIN
  
PASSWORD:
  KEYPASS = 0
  INPUT "PASSWORD"; PASS$
  PASSLEN = LEN(PASS$)
    FOR COUNT = 1 TO PASSLEN
      KEYPASS = KEYPASS + ASC(LEFT$(PASS$, COUNT))
    NEXT COUNT
  RANDOMIZE (KEYPASS)
    FOR COUNT = 1 TO PASSLEN
      DUMMY = INT(RND * ASC(LEFT$(PASS$, COUNT))) + 1
    NEXT COUNT
  RETURN

THINK1:
  COLOR 15, 4: LOCATE 1, 79: PRINT "-"
  LOCATE 1, 79: PRINT "\"
  RETURN
 
THINK2:
  COLOR 15, 4: LOCATE 1, 79: PRINT "|"
  LOCATE 1, 79: PRINT "/"
  RETURN

ERRTRAP:
  COLOR 15, 4
  LOCATE 15, 1: PRINT " ERROR IN FILE HANDLING! "
  PRINT " ERROR NUMBER "; ERR
  SLEEP 3                              ' Delay 3 seconds
  CLOSE
  RESUME BEGIN

QUIT:
  COLOR 15, 0: CLS : END

